(function(t){function e(e){for(var i,a,s=e[0],f=e[1],o=e[2],c=0,p=[];c<s.length;c++)a=s[c],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&p.push(r[a][0]),r[a]=0;for(i in f)Object.prototype.hasOwnProperty.call(f,i)&&(t[i]=f[i]);h&&h(e);while(p.length)p.shift()();return n.push.apply(n,o||[]),u()}function u(){for(var t,e=0;e<n.length;e++){for(var u=n[e],i=!0,a=1;a<u.length;a++){var f=u[a];0!==r[f]&&(i=!1)}i&&(n.splice(e--,1),t=s(s.s=u[0]))}return t}var i={},r={app:0},n=[];function a(t){return s.p+"js/"+({about:"about"}[t]||t)+"."+{about:"6894a3e5"}[t]+".js"}function s(e){if(i[e])return i[e].exports;var u=i[e]={i:e,l:!1,exports:{}};return t[e].call(u.exports,u,u.exports,s),u.l=!0,u.exports}s.e=function(t){var e=[],u=r[t];if(0!==u)if(u)e.push(u[2]);else{var i=new Promise((function(e,i){u=r[t]=[e,i]}));e.push(u[2]=i);var n,f=document.createElement("script");f.charset="utf-8",f.timeout=120,s.nc&&f.setAttribute("nonce",s.nc),f.src=a(t);var o=new Error;n=function(e){f.onerror=f.onload=null,clearTimeout(c);var u=r[t];if(0!==u){if(u){var i=e&&("load"===e.type?"missing":e.type),n=e&&e.target&&e.target.src;o.message="Loading chunk "+t+" failed.\n("+i+": "+n+")",o.name="ChunkLoadError",o.type=i,o.request=n,u[1](o)}r[t]=void 0}};var c=setTimeout((function(){n({type:"timeout",target:f})}),12e4);f.onerror=f.onload=n,document.head.appendChild(f)}return Promise.all(e)},s.m=t,s.c=i,s.d=function(t,e,u){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:u})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var u=Object.create(null);if(s.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(u,i,function(e){return t[e]}.bind(null,i));return u},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/falling-sand-game/",s.oe=function(t){throw console.error(t),t};var f=window["webpackJsonp"]=window["webpackJsonp"]||[],o=f.push.bind(f);f.push=e,f=f.slice();for(var c=0;c<f.length;c++)e(f[c]);var h=o;n.push([0,"chunk-vendors"]),u()})({0:function(t,e,u){t.exports=u("cd49")},"5c0b":function(t,e,u){"use strict";var i=u("9c0c"),r=u.n(i);r.a},"9c0c":function(t,e,u){},cd49:function(t,e,u){"use strict";u.r(e);u("e260"),u("e6cf"),u("cca6"),u("a79d");var i,r=u("2b0e"),n=function(){var t=this,e=t.$createElement,u=t._self._c||e;return u("div",{attrs:{id:"app"}},[u("div",{attrs:{id:"nav"}},[u("router-link",{attrs:{to:"/"}},[t._v("Home")]),t._v(" | "),u("router-link",{attrs:{to:"/about"}},[t._v("About")])],1),u("router-view")],1)},a=[],s=(u("5c0b"),u("2877")),f={},o=Object(s["a"])(f,n,a,!1,null,null,null),c=o.exports,h=(u("d3b7"),u("8c4f")),p=function(){var t=this,e=t.$createElement,u=t._self._c||e;return u("div",{staticClass:"home"},[u("Game")],1)},l=[],d=function(){var t=this,e=t.$createElement,u=t._self._c||e;return u("div",[u("canvas",{ref:"canvas",staticStyle:{border:"1px solid black"},attrs:{width:t.canvasWidth,height:t.canvasHeight}}),u("div",[u("p",[t._v(t._s(t.particleTypeName))]),u("Button",{on:{click:function(e){return t.onTypeSelected(2)}}},[t._v("sand")]),u("Button",{on:{click:function(e){return t.onTypeSelected(3)}}},[t._v("water")]),u("Button",{on:{click:function(e){return t.onTypeSelected(4)}}},[t._v("plant")]),u("Button",{on:{click:function(e){return t.onTypeSelected(5)}}},[t._v("fire")]),u("Button",{on:{click:function(e){return t.onTypeSelected(6)}}},[t._v("salt")]),u("Button",{on:{click:function(e){return t.onTypeSelected(0)}}},[t._v("empty")])],1),u("div",[u("p",[t._v(t._s(t.brushSizeName))]),u("Button",{on:{click:function(e){return t.onBrushSelected(0)}}},[t._v("small")]),u("Button",{on:{click:function(e){return t.onBrushSelected(1)}}},[t._v("medium")]),u("Button",{on:{click:function(e){return t.onBrushSelected(2)}}},[t._v("large")])],1),u("p",[t._v(t._s(this.fps)+" fps")]),u("Button",{on:{click:t.debugFill}},[t._v(" debug fill ")]),u("Button",{on:{click:t.onPauseClicked}},[t._v(" "+t._s(t.paused?"resume":"pause")+" ")]),t.paused?u("div",[u("p",[t._v("PAUSED")]),u("Button",{on:{click:t.onStepClicked}},[t._v("step")])],1):t._e()],1)},v=[],B=u("d4ec"),T=u("bee2"),m=u("262e"),A=u("2caf"),b=u("9ab4"),y=u("60a3"),S=u("22a2");u("99af"),u("cb29"),u("5cc6"),u("9a8c"),u("a975"),u("735e"),u("c1ac"),u("d139"),u("3a7b"),u("d5d6"),u("82f8"),u("e91f"),u("60bd"),u("5f96"),u("3280"),u("3fcc"),u("ca91"),u("25a1"),u("cd26"),u("3c5d"),u("2954"),u("649e"),u("219c"),u("170b"),u("b39a"),u("72f7");(function(t){t[t["SMALL"]=0]="SMALL",t[t["MEDIUM"]=1]="MEDIUM",t[t["LARGE"]=2]="LARGE"})(i||(i={}));var E,g=i,k=[0,0,0,220,220,220,194,178,128,128,197,222,50,205,50,170,16,0,244,244,244,128,230,255],L=new Uint8Array(k),P=L;(function(t){t[t["EMPTY"]=0]="EMPTY",t[t["WALL"]=1]="WALL",t[t["SAND"]=2]="SAND",t[t["WATER"]=3]="WATER",t[t["PLANT"]=4]="PLANT",t[t["FIRE"]=5]="FIRE",t[t["SALT"]=6]="SALT",t[t["SALT_WATER"]=7]="SALT_WATER"})(E||(E={}));var w,I=E;(function(t){t[t["SOLID"]=0]="SOLID",t[t["GRAIN"]=1]="GRAIN",t[t["LIQUID"]=2]="LIQUID",t[t["GAS"]=3]="GAS"})(w||(w={}));var M=w,_=[M.SOLID,M.SOLID,M.GRAIN,M.LIQUID,M.SOLID,M.GAS,M.GRAIN,M.LIQUID],R=_,x=[5,255,9,7,5,5,6,8],W=(new Uint8Array(x),x),N=128,D=128,O=new Uint8Array(N*D*3).fill(0),G=function(){function t(){Object(B["a"])(this,t),this.frames=0,this.expectedParticleCount=0,this.lastParticleCount=0,this.inputBuffer=this.createBuffer(),this.outputBuffer=this.createBuffer(),this.updateBuffer=this.createBuffer()}return Object(T["a"])(t,[{key:"createBuffer",value:function(){var t=new Uint8Array(N*D);return this.fillBuffer(t),t}},{key:"fillBuffer",value:function(t){for(var e=0;e<N*D;++e)t[e]=I.EMPTY}},{key:"clearBuffers",value:function(){for(var t=0;t<D;++t)for(var e=0;e<D;++e){var u=t*D+e;this.outputBuffer[u]=I.EMPTY,this.updateBuffer[u]=I.EMPTY,0!==t&&t!==D-1&&0!==e&&e!==N-1||(this.inputBuffer[u]=I.WALL,this.outputBuffer[u]=I.WALL)}}},{key:"particleIndex",value:function(t,e){return e*D+t}},{key:"tick",value:function(){this.clearBuffers(),this.updateGame(),this.updateFramebuffer(),this.swapBuffers()}},{key:"updateGame",value:function(){this.frames++,this.frames%60===0&&console.log("expected: ".concat(this.expectedParticleCount," last: ").concat(this.lastParticleCount)),this.lastParticleCount=0;for(var t=0;t<D;++t)for(var e=0;e<N;++e){var u=this.particleIndex(e,t),i=0!==this.updateBuffer[u],r=this.inputBuffer[u],n=W[r],a=R[r];if(r!==I.EMPTY&&r!==I.WALL&&!i){this.lastParticleCount++;var s=this.particleIndex(e-1,t),f=this.particleIndex(e,t+1),o=this.particleIndex(e+1,t),c=this.particleIndex(e,t-1),h=this.particleIndex(e-1,t+1),p=this.particleIndex(e+1,t+1),l=this.inputBuffer[s],d=this.inputBuffer[f],v=this.inputBuffer[o],B=this.inputBuffer[c],T=this.inputBuffer[h],m=this.inputBuffer[p],A=0!==this.updateBuffer[f],b=0!==this.updateBuffer[s],y=0!==this.updateBuffer[o],S=(this.updateBuffer[c],0!==this.updateBuffer[h]),E=0!==this.updateBuffer[p],g=R[d],k=(R[l],R[v],R[B],R[T],R[m],d===I.EMPTY&&!A),L=l===I.EMPTY&&!b,P=v===I.EMPTY&&!y,w=T===I.EMPTY&&l===I.EMPTY&&!S,_=m===I.EMPTY&&v===I.EMPTY&&!E,x=W[d]<n&&d!==I.EMPTY&&!A;r===I.SALT&&I.WATER;if(x&&g===r)this.outputBuffer[f]=r,this.outputBuffer[u]=d,this.updateBuffer[f]=1,this.updateBuffer[u]=1;else{if(a===M.GRAIN){if(k){this.outputBuffer[f]=r,this.updateBuffer[f]=1;continue}if(w){this.outputBuffer[h]=r,this.updateBuffer[h]=1;continue}if(_){this.outputBuffer[p]=r,this.updateBuffer[p]=1;continue}}else if(a===M.LIQUID){if(k){this.outputBuffer[f]=r,this.updateBuffer[f]=1;continue}if(w){this.outputBuffer[h]=r,this.updateBuffer[h]=1;continue}if(_){this.outputBuffer[p]=r,this.updateBuffer[p]=1;continue}if(L){this.outputBuffer[s]=r,this.updateBuffer[s]=1;continue}if(P){this.outputBuffer[o]=r,this.updateBuffer[o]=1;continue}}switch(r){case I.SAND:this.outputBuffer[u]=I.SAND,this.updateBuffer[u]=1;break;case I.WATER:var O=d===I.SALT&&!A;O?(this.outputBuffer[f]=I.SALT_WATER,this.outputBuffer[u]=I.EMPTY,this.updateBuffer[f]=1,this.updateBuffer[u]=1):(this.outputBuffer[u]=I.WATER,this.updateBuffer[u]=1);break;case I.PLANT:l===I.WATER&&(this.outputBuffer[s]=I.PLANT,this.updateBuffer[s]=1),d===I.WATER&&(this.outputBuffer[f]=I.PLANT,this.updateBuffer[f]=1),v===I.WATER&&(this.outputBuffer[o]=I.PLANT,this.updateBuffer[o]=1),B===I.WATER&&(this.outputBuffer[c]=I.PLANT,this.updateBuffer[c]=1),this.outputBuffer[u]=I.PLANT,this.updateBuffer[u]=1;break;case I.FIRE:l===I.PLANT&&(this.outputBuffer[s]=I.FIRE,this.updateBuffer[s]=1),d===I.PLANT&&(this.outputBuffer[f]=I.FIRE,this.updateBuffer[f]=1),v===I.PLANT&&(this.outputBuffer[o]=I.FIRE,this.updateBuffer[o]=1),B===I.PLANT&&(this.outputBuffer[c]=I.FIRE,this.updateBuffer[c]=1),this.outputBuffer[u]=I.EMPTY,this.updateBuffer[u]=1;break;case I.SALT:var G=d===I.WATER&&!A;G?(this.outputBuffer[f]=I.SALT_WATER,this.outputBuffer[u]=I.EMPTY,this.updateBuffer[f]=1,this.updateBuffer[u]=1):(this.outputBuffer[u]=I.SALT,this.updateBuffer[u]=1);break;case I.SALT_WATER:var Y=d===I.WATER&&!A,j=T===I.WATER&&!S,C=m===I.WATER&&!E;Y?(this.outputBuffer[f]=I.SALT_WATER,this.outputBuffer[u]=I.WATER,this.updateBuffer[f]=1,this.updateBuffer[u]=1):j?(this.outputBuffer[h]=I.SALT_WATER,this.outputBuffer[u]=I.WATER,this.updateBuffer[h]=1,this.updateBuffer[u]=1):C?(this.outputBuffer[p]=I.SALT_WATER,this.outputBuffer[u]=I.WATER,this.updateBuffer[p]=1,this.updateBuffer[u]=1):(this.outputBuffer[u]=I.SALT_WATER,this.updateBuffer[u]=1);break}}}}}},{key:"updateFramebuffer",value:function(){for(var t=0;t<D;++t)for(var e=0;e<N;++e){var u=this.outputBuffer[this.particleIndex(e,t)],i=3*u,r=t*(3*N)+3*e;this.framebuffer[r]=P[i],this.framebuffer[r+1]=P[i+1],this.framebuffer[r+2]=P[i+2]}}},{key:"swapBuffers",value:function(){var t=this.inputBuffer;this.inputBuffer=this.outputBuffer,this.outputBuffer=t}},{key:"createParticle",value:function(t,e,u,i){try{switch(i){case g.SMALL:this.inputBuffer[this.particleIndex(t,e)]=u,u!==I.EMPTY&&this.expectedParticleCount++;break;case g.MEDIUM:for(var r=-1;r<2;++r)this.inputBuffer[this.particleIndex(t+r,e+r)]=u,u!==I.EMPTY&&this.expectedParticleCount++;break;case g.LARGE:for(var n=-2;n<3;++n)this.inputBuffer[this.particleIndex(t+n,e+n)]=u,u!==I.EMPTY&&this.expectedParticleCount++;break}}catch(a){console.error(a)}}},{key:"width",get:function(){return N}},{key:"height",get:function(){return D}},{key:"framebuffer",get:function(){return O}}]),t}(),Y=function(t){Object(m["a"])(u,t);var e=Object(A["a"])(u);function u(){var t;return Object(B["a"])(this,u),t=e.apply(this,arguments),t.sandGame=new G,t.gameWidth=t.sandGame.width,t.gameHeight=t.sandGame.height,t.particleType=I.SAND,t.brushSize=g.SMALL,t.canvasScale=4,t.canvasWidth=t.gameWidth*t.canvasScale,t.canvasHeight=t.gameHeight*t.canvasScale,t.mouseX=0,t.mouseY=0,t.drawing=!1,t.lastMilliseconds=0,t.fps=0,t.paused=!1,t.texture=S["e"].fromBuffer(t.sandGame.framebuffer,t.gameWidth,t.gameHeight,{format:S["b"].RGB,type:S["d"].UNSIGNED_BYTE}),t.sprite=S["c"].from(t.texture),t}return Object(T["a"])(u,[{key:"mounted",value:function(){var t=this.$refs.canvas;this.canvas=t,this.setupPixi(),this.bindInputEvents(),requestAnimationFrame(this.gameLoop)}},{key:"setupPixi",value:function(){this.pixiApp=new S["a"]({width:this.canvasWidth,height:this.canvasHeight,view:this.canvas}),this.sprite.interactive=!0,this.sprite.setTransform(0,0,this.canvasScale,this.canvasScale),this.pixiApp.renderer.plugins.interaction.moveWhenInside=!0,this.pixiApp.stage.addChild(this.sprite)}},{key:"bindInputEvents",value:function(){this.sprite.on("touchmove",this.onTouchPointerMove),this.sprite.on("pointermove",this.onTouchPointerMove),this.sprite.on("touchstart",this.startDrawing),this.sprite.on("touchend",this.stopDrawing),this.sprite.on("pointerdown",this.startDrawing),this.sprite.on("pointerup",this.stopDrawing)}},{key:"onTouchPointerMove",value:function(t){this.mouseX=Math.floor(t.data.global.x/this.canvasScale),this.mouseY=Math.floor(t.data.global.y/this.canvasScale)}},{key:"startDrawing",value:function(){this.drawing=!0}},{key:"stopDrawing",value:function(){this.drawing=!1}},{key:"destroyed",value:function(){this.texture.destroy(),this.sprite.destroy(),this.pixiApp.destroy()}},{key:"calculateFPS",value:function(){var t=Date.now(),e=t-this.lastMilliseconds;this.fps=Math.floor(1/e*1e3),this.lastMilliseconds=t}},{key:"drawSand",value:function(){this.drawing&&this.sandGame.createParticle(this.mouseX,this.mouseY,this.particleType,this.brushSize)}},{key:"gameLoop",value:function(){this.calculateFPS(),this.drawSand(),this.paused||this.sandGame.tick(),this.texture.update(),requestAnimationFrame(this.gameLoop)}},{key:"onPauseClicked",value:function(){this.paused=!this.paused}},{key:"onStepClicked",value:function(){this.sandGame.tick()}},{key:"onTypeSelected",value:function(t){this.particleType=t}},{key:"onBrushSelected",value:function(t){this.brushSize=t}},{key:"debugFill",value:function(){for(var t=1;t<this.gameHeight-1;++t)for(var e=1;e<this.gameWidth-1;++e){var u=I.EMPTY,i=~~(3*Math.random());0==i&&(u=I.SAND),1===i&&(u=I.WATER),this.sandGame.createParticle(e,t,u,g.SMALL)}}},{key:"particleTypeName",get:function(){return I[this.particleType]}},{key:"brushSizeName",get:function(){return g[this.brushSize]}}]),u}(y["b"]);Y=Object(b["a"])([y["a"]],Y);var j=Y,C=j,F=Object(s["a"])(C,d,v,!1,null,"50838a8a",null),U=F.exports,H={name:"Home",components:{Game:U}},z=H,Q=Object(s["a"])(z,p,l,!1,null,null,null),$=Q.exports;r["a"].use(h["a"]);var q=[{path:"/",name:"Home",component:$},{path:"/about",name:"About",component:function(){return u.e("about").then(u.bind(null,"f820"))}}],X=new h["a"]({routes:q}),J=X,K=u("2f62");r["a"].use(K["a"]);var V=new K["a"].Store({state:{},mutations:{},actions:{},modules:{}});r["a"].config.productionTip=!1,new r["a"]({router:J,store:V,render:function(t){return t(c)}}).$mount("#app")}});
//# sourceMappingURL=app.11d77755.js.map